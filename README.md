# 商品調査・分析アプリ

## プロジェクト概要

タブベースのインターface を持つ包括的な商品調査・分析アプリです。「調査開始」「調査結果」「分析結果」の3つのタブで、AIチャットボットによる調査実行から結果の可視化まで、ワンストップで商品分析業務を支援します。美しいグラデーションデザインと直感的なUIにより、プロフェッショナルな分析体験を提供します。

## 🚀 主要機能

### ✅ 完了済み機能

#### 0. 楽天商品調査ワークフロー 🆕 **NEW!**
- **ec_rakuten.yml実装**: DifyワークフローをWebアプリ化
- **楽天API連携**: 商品検索・詳細取得・価格情報取得
- **自動データ取得**: 検索キーワード・価格範囲・除外キーワードで商品検索
- **Google Sheets自動書き込み**: 取得データを自動的にスプレッドシートに記録
- **レビュー分析**: 直近3ヶ月のレビューを自動取得・分析
- **感情分析**: 高評価・中評価・低評価レビューを分類
- **進捗表示**: リアルタイムで処理状況を表示
- **UI統合**: モーダル形式で簡単にワークフローを実行

### ✅ 完了済み機能

#### 1. タブベースインターface ✨
- **4つのメインタブ**: 調査開始・調査結果・分析結果・レビュー分析
- **直感的ナビゲーション**: アイコン付きタブで機能を明確に分類
- **グラデーション背景**: 美しいグラデーションによるプロフェッショナルなデザイン
- **透明効果**: バックドロップフィルターによるモダンなガラス効果

#### 2. 調査開始タブ 🔍
- **AIチャットボット統合**: Dify AIアシスタントとの対話インターface
- **フルスクリーン表示**: チャット開始時の全画面没入体験
- **スムーズ起動**: ワンクリックでAI調査開始
- **視覚的フィードバック**: ロボットアイコンとガイダンス

#### 3. 調査結果タブ 📊 (生データ表示)
- **スプレッドシート連動**: Google Sheetsの生データをそのままテーブル表示
- **高度な検索・フィルタ**: テキスト検索とリアルタイムフィルタリング
- **ソート機能**: 列ヘッダークリックで昇順・降順ソート（数値・文字列対応）
- **ページネーション**: 10/25/50/100件表示、全件表示対応
- **CSV出力機能**: フィルタ済みデータのCSVダウンロード
- **検索ハイライト**: 検索キーワードの黄色ハイライト表示
- **レスポンシブテーブル**: スマートフォンでもスクロール可能

#### 4. 分析結果タブ 📈 (統計・チャート表示)
- **自動統計生成**: スプレッドシートデータから統計値を自動算出
- **動的価格分布分析**: カスタム価格幅設定による価格帯別チャート ✨ **NEW!**
  - 価格幅入力（1000円～50000円、1000円単位）
  - リアルタイム更新ボタンによる動的チャート生成
  - 自動価格レンジ計算とラベル生成
- **評価分布分析**: 実データに基づく星評価別チャート
- **競合ポジショニング分析**: 市場ポジション・価格優位性の可視化
- **AI推奨アクション**: データに基づく具体的な戦略提案

**注意**: 「商品名テキストマイニング」「市場トレンド分析」「競合分析」は開発中のためコメントアウト中

#### 5. データ可視化機能
- **Chart.js統合**: プロフェッショナルなチャートライブラリ
- **複数チャートタイプ**: 棒グラフ・ドーナツ・線グラフ
- **レスポンシブチャート**: 画面サイズに応じた自動調整
- **インタラクティブ操作**: ホバー・クリック効果

#### 6. 高品質ワードクラウド ✨ **UPGRADED!** 
- **WordCloud2.js統合**: 業界標準のプロ仕様ワードクラウドライブラリ
- **高解像度対応**: デバイスピクセル比対応で高精細レンダリング
- **円形配置アルゴリズム**: 中央集約型の美しい円形レイアウト
- **完全水平表示**: 回転なし、すべて読みやすい横書き
- **ゼロ重複保証**: 高精度衝突検知で文字重複を完全防止
- **高度日本語処理**: N-gram解析・複合語抽出・形態素解析レベル
- **インテリジェントカラー**: HSLベースの重要度連動カラーシステム
- **レスポンシブ対応**: 画面サイズ変更時の自動再描画
- **エラー耐性**: フォールバック機構とリトライシステム
- **パフォーマンス最適化**: 非同期生成とメモリ効率化

#### 7. レビュー感情分析 🆕 **NEW!**
- **専用レビュー分析タブ**: 顧客の生の声から商品の強みと改善点を発見
- **感情分析ダッシュボード**: 高評価・中評価・低評価コメントの詳細統計
- **感情別ワードクラウド**: 高評価・中評価・低評価キーワードの可視化
- **商品別感情スコア**: 商品ごとの感情スコア比較チャート
- **強み・弱み分析**: 高評価・低評価コメントからのインサイト抽出
- **AI推奨アクション**: レビュー分析に基づく具体的な改善提案
- **感情トレンド分析**: 時系列での感情変化の可視化
- **総合感情スコア**: 3点満点での全体感情評価

#### 8. レスポンシブデザイン
- **マルチデバイス対応**: PC・タブレット・スマートフォン最適化
- **タブレット最適化**: 中型画面での見やすいレイアウト
- **モバイルフレンドリー**: スマートフォンでの操作性重視

### 🔄 開発中機能

#### レポート出力機能
- **HTMLレポート**: 分析結果の静的HTMLファイル出力 ✅
- **PDFレポート**: プロフェッショナルなPDF形式での出力 🚧
- **データエクスポート**: CSV/Excel形式でのデータダウンロード 🚧

### 📋 未実装機能

#### API連携機能
- **Yahoo!ショッピングAPI**: リアルタイムデータ同期
- **データ取得スケジューラー**: 定期実行・自動更新
- **レート制限管理**: API制限に応じた取得制御
- **レビュー取得プロキシ**: CORS制限を回避するバックエンドAPI（レビュー分析に必要）

#### Google Sheets書き込み機能
- **OAuth認証**: Google Sheets API v4への書き込みには認証が必要
- **Google Apps Script**: Webアプリとして公開して書き込み機能を実現
- **バックエンドAPI**: サーバーサイドでGoogle Sheets APIを呼び出す

## 🏗️ 技術仕様

### フロントエンド
- **HTML5**: セマンティックなマークアップ
- **TailwindCSS**: ユーティリティファーストCSSフレームワーク  
- **JavaScript (ES6+)**: モダンなJavaScript機能
- **Font Awesome**: アイコンライブラリ
- **Google Fonts (Inter)**: 美しいタイポグラフィ
- **CSS Gradients**: グラデーション背景によるモダンデザイン

### バックエンド（Vercel Functions） ✨ **NEW!**
- **Vercel Serverless Functions**: サーバーレスAPI
- **Node.js**: ランタイム環境
- **APIエンドポイント**:
  - `/api/rakuten-search` - 楽天商品検索
  - `/api/sheets-write` - Google Sheets書き込み
  - `/api/proxy-rakuten` - 楽天ページ取得（プロキシ）

### AI・チャットボット
- **Dify Chatbot**: フルスクリーンAI分析アシスタント
- **フルスクリーンUI**: 没入感のある全画面チャットインターface
- **リアルタイム分析**: ユーザー入力に対する即座の分析実行

### データ連携・API
- **Google Sheets API**: スプレッドシートからのリアルタイムデータ取得・書き込み
- **楽天市場API**: 商品検索・詳細情報取得・価格情報取得
- **自動データ処理**: 価格・評価・ブランド情報の自動分析
- **キャッシュシステム**: 5分間のデータキャッシュでパフォーマンス向上
- **エラーハンドリング**: 接続失敗時のフォールバック機能
- **レビュー分析API**: 楽天レビューページからのデータ取得（プロキシ必要）

### バックエンド・データ管理
- **RESTful API**: テーブル操作用のAPI設計
- **Supabaseテーブル**: 以下のデータスキーマを定義済み
  - `users`: ユーザー認証情報
  - `projects`: プロジェクト管理
  - `queries`: 検索条件・実行履歴
  - `items`: 商品情報
  - `reviews`: レビューデータ
  - `metrics_daily`: 日次集計結果
  - `insights`: AI分析結果

### 主要ライブラリ・サービス
- **Chart.js**: データ可視化
- **WordCloud2.js**: プロ仕様高品質ワードクラウド生成 ✨ **NEW!**
- **Supabase**: バックエンド・データベース
- **楽天市場API**: 実際の商品データ取得（実装済み） ✨ **NEW!**
- **模擬API**: Yahoo API代替のサンプルデータ生成

## 📱 対応デバイス・ブラウザ

### デバイス
- **スマートフォン**: iOS 12+、Android 8+
- **タブレット**: iPad、Android タブレット
- **デスクトップ**: Windows、Mac、Linux

### ブラウザ
- **Chrome** 80+
- **Safari** 13+
- **Firefox** 75+
- **Edge** 80+

## 🚀 使用方法

### タブベースの直感的ワークフロー

#### 1. アプリ起動・概要確認
1. `index.html` をブラウザで開く
2. 美しいグラデーション背景の3タブインターface が表示
3. 各タブの機能を確認

#### 2. 🔍 調査開始タブで分析実行
1. 「調査開始」タブを選択（デフォルト）
2. **方法A: AIチャットボットを使用**
   - 「チャットを開始」ボタンをクリック
   - 全画面AIチャットボットが起動
   - AIアシスタントに分析内容を指示
     - 例: 「iPhone ケースの市場調査をして」
     - 例: 「Nintendo Switchの競合分析をお願いします」
     - 例: 「ワイヤレスイヤホンの価格分析を実行して」
3. **方法B: 楽天商品調査ワークフローを使用** 🆕
   - 「楽天商品調査を実行」ボタンをクリック
   - 検索キーワード・価格範囲・除外キーワードを入力
   - 楽天アプリIDを設定（デフォルト値あり）
   - 「調査開始」ボタンで実行
   - 自動的にGoogle Sheetsにデータが書き込まれます

#### 3. 📊 調査結果タブで生データ確認
1. 「調査結果」タブに切り替え
2. 「データ更新」ボタンでGoogle Sheetsから最新データを取得
3. スプレッドシートの生データをテーブル形式で表示
   - データ検索・フィルタリング機能
   - 列ヘッダークリックでソート（昇順・降順）
   - ページネーション（10/25/50/100件表示）
   - 検索ハイライト機能
4. 「CSV出力」ボタンでデータをダウンロード
5. データ概要表示（総行数・列数・最終更新時刻）

#### 4. 📈 分析結果タブで統計分析・戦略立案
1. 「分析結果」タブで自動生成された統計情報を確認
   - 統計ダッシュボード（商品数・平均価格・評価・競合数）
   - 価格分布チャート（実データに基づく棒グラフ）
   - 評価分布チャート（実データに基づくドーナツチャート）
2. 市場トレンドの時系列変化を把握
3. 競合分析で市場ポジション理解
4. AI推奨アクションで次のステップ決定

#### 5. 💬 レビュー分析タブで感情・インサイト分析 **NEW!**
1. 「レビュー分析」タブで顧客の生の声を詳細分析
   - 感情分析サマリー（高評価・中評価・低評価の詳細統計）
   - 総合感情スコア（3点満点での全体評価）
   - 感情分布チャート（円グラフ・トレンドチャート）
2. 感情別キーワード分析
   - 高評価キーワードのワードクラウド
   - 中評価キーワードのワードクラウド
   - 低評価キーワードのワードクラウド
3. 詳細インサイト分析
   - 商品の強み分析（よく言及される強み TOP15）
   - 改善ポイント分析（よく指摘される課題 TOP15）
4. 商品別感情スコア比較
   - 商品ごとの感情スコア比較チャート
   - 最高評価商品・改善必要商品の特定
   - 平均感情スコアのベンチマーク
5. AI推奨アクション（レビュー分析版）
   - レビューデータに基づく具体的な改善提案
   - 感情分布に応じた戦略的アドバイス

### 🎯 対応分析内容
- **市場調査**: キーワードベースの市場規模・成長率・トレンド分析
- **競合分析**: 価格・機能・レビュー・市場シェア比較
- **価格分析**: 分布・統計・適正価格・価格戦略提案
- **レビュー感情分析**: 高評価・中評価・低評価コメントの感情スコア分析
- **インサイト抽出**: 強み・弱み・改善ポイントの詳細分析
- **戦略提案**: 参入戦略・差別化・マーケティング施策

### 📱 ワークフロー例
1. **調査開始** → AIで「スマートウォッチ市場調査」依頼
2. **調査結果** → Google Sheetsから実データ取得、統計・チャート自動生成
3. **分析結果** → AIとリアルデータに基づく戦略提案
4. **レビュー分析** → 顧客レビューから感情分析・インサイト抽出・改善提案

### 🔗 Google Sheets 連携設定

#### スプレッドシートの準備
- **スプレッドシートID**: `1wdH9PXo6cgzG258Dl_L4JmubYtSYe4V3ZruAim6KAOY`
- **必要な列**: 商品名, 価格, 評価, レビュー数, ブランド, カテゴリ
- **データ形式**: 1行目はヘッダー, 2行目以降はデータ

#### 対応するデータフィールド
```python
# Pythonコード例（参考）
df = pd.DataFrame(data)
# 列名は自動検出:
# - 価格: 'price', '価格', '値段' を含む列
# - 評価: 'rating', '評価', 'レビュー' を含む列  
# - ブランド: 'brand', 'ブランド', 'メーカー' を含む列
```

## 📊 データ構造

### プロジェクトテーブル
```javascript
{
  id: "project_xxx",
  user_id: "user_xxx", 
  name: "iPhone ケース市場調査",
  search_keyword: "iPhone ケース",
  marketplace: "both", // rakuten, yahoo, both
  min_price: 500,
  max_price: 15000,
  status: "completed", // created, analyzing, completed, error
  created_at: "2024-01-15T09:00:00Z"
}
```

### 商品データテーブル  
```javascript
{
  id: "item_xxx",
  query_id: "query_xxx",
  name: "iPhone 15 Pro 耐衝撃ケース",
  price: 2980,
  rating: 4.3,
  review_count: 1250,
  shop_name: "スマホアクセサリーShop",
  marketplace: "rakuten"
}
```

### メトリクステーブル
```javascript
{
  id: "metrics_xxx",
  query_id: "query_xxx", 
  date: "2024-01-15T00:00:00Z",
  total_items: 1250,
  avg_price: 2850,
  median_price: 2500,
  min_price: 480,
  max_price: 12800,
  avg_rating: 4.2,
  sentiment_positive_ratio: 0.78
}
```

## 🔒 セキュリティ

- **パスワードハッシュ化**: bcrypt使用（本格実装時）
- **HTTPS通信**: SSL/TLS暗号化
- **XSS対策**: HTMLエスケープ処理
- **CSRF対策**: トークン認証（本格実装時）
- **データ検証**: 入力値検証・サニタイズ

## 🎯 今後の開発予定

### Phase 1: API連携（優先度: 高）
- 楽天市場API・Yahoo!ショッピングAPIの実装
- リアルタイムデータ取得・更新機能
- エラーハンドリング・リトライ機構

### Phase 2: 高度な分析（優先度: 中）
- 機械学習による需要予測
- 価格変動トレンド分析  
- SNSトレンド連携（Twitter、Instagram）
- 競合商品の自動検出・追跡

### Phase 3: エンタープライズ機能（優先度: 低）
- チーム共有・権限管理
- APIキー管理・ユーザー別制限
- 通知機能（メール・Slack・LINE）
- 大容量データ処理・バッチ分析

## 🆕 最新アップデート

### v3.1 - Vercel Functions実装 (2025-01-27)
- **Vercel Serverless Functions**: バックエンドAPIをサーバーレス化
- **楽天API検索エンドポイント**: `/api/rakuten-search` を実装
- **Google Sheets書き込みエンドポイント**: `/api/sheets-write` を実装
- **楽天ページ取得プロキシ**: `/api/proxy-rakuten` を実装（CORS回避）
- **フロントエンド統合**: すべてのAPI呼び出しをVercel Functions経由に変更
- **環境変数管理**: Vercelダッシュボードで環境変数を設定可能
- **デプロイ自動化**: GitHub連携で自動デプロイ

### v3.0 - 楽天商品調査ワークフロー実装 (2025-01-27)
- **ec_rakuten.yml実装**: Difyワークフローを完全にWebアプリ化
- **楽天API統合**: 実際の楽天市場APIを使用した商品検索・取得
- **自動データ書き込み**: Google Sheetsへの自動データ記録機能
- **レビュー分析**: 直近3ヶ月のレビュー自動取得・感情分析
- **ワークフローUI**: モーダル形式の直感的な操作インターフェース
- **進捗表示**: リアルタイム進捗バーとログ表示
- **エラーハンドリング**: 堅牢なエラー処理とリトライ機能

### v2.2 - 動的価格分布分析機能追加 (2025-01-27)
- **動的価格幅設定**: ユーザーがカスタム価格間隔を設定可能（1000円～50000円、1000円単位）
- **リアルタイム更新**: 価格幅変更時の即座なチャート更新機能
- **自動価格レンジ生成**: 最大価格に基づく動的な価格レンジとラベル生成
- **UI改善**: 価格幅入力とワンクリック更新ボタンの追加
- **セクション整理**: 開発中機能（商品名テキストマイニング、市場トレンド分析、競合分析）のコメントアウト
- **デバッグ機能強化**: 評価分布分析の精度検証とデータ処理ログの追加

### v2.1 - レビュー分析タブ追加 (2025-01-20)
- **専用レビュー分析タブ**: 新たに4つ目のタブとして「レビュー分析」を追加
- **感情分析ダッシュボード**: 高評価・中評価・低評価コメントの統計分析
- **感情別ワードクラウド**: 感情ごとに色分けされた高品質ワードクラウド
- **商品別感情スコア比較**: 商品ごとの感情スコア（3点満点）比較チャート
- **詳細インサイト抽出**: 強み・弱み分析と改善ポイントの自動抽出
- **AI推奨アクション**: レビュー分析に基づく具体的な改善提案
- **高度なレビュー分析**: updateAdvancedReviewAnalysis()関数による包括的分析

### v2.0 - WordCloud2.js統合 (2024-01-20)
- **プロ仕様ワードクラウド**: 業界標準WordCloud2.jsライブラリを導入
- **高度日本語処理**: N-gram解析、複合語抽出、形態素解析レベルの精度
- **高解像度対応**: 4K・Retinaディスプレイでの高精細表示
- **レスポンシブ最適化**: 画面サイズ変更時の自動再描画
- **パフォーマンス向上**: 非同期処理とメモリ効率化で大量データ対応
- **エラー耐性強化**: フォールバック機構とリトライシステム

## 📞 サポート

### 問題報告・機能要望
- GitHub Issues でのバグレポート
- 機能改善提案・追加要望
- UIデザイン・操作性改善

### ドキュメント
- API仕様書: 各テーブル操作の詳細
- チュートリアル: ステップバイステップガイド
- FAQ: よくある質問・トラブルシューティング

---

## 📈 分析機能詳細

### 価格分析
- **ヒストグラム**: 価格分布の可視化
- **統計情報**: 平均・中央値・四分位数
- **外れ値検出**: 異常価格の特定
- **価格トレンド**: 時系列変化の分析

### レビュー感情分析 🆕
- **感情スコア**: 3点満点（高評価3点・中評価2点・低評価1点）による加重平均評価
- **感情分布分析**: 高評価・中評価・低評価コメントの詳細統計
- **キーワード抽出**: TF-IDF・共起語分析による重要キーワード抽出
- **感情別ワードクラウド**: 感情ごとに色分けされた視覚的キーワード分析
- **商品別感情比較**: 商品ごとの感情スコア比較チャート
- **強み・弱み分析**: 高評価・低評価コメントからの自動インサイト抽出
- **AI推奨アクション**: レビュー分析に基づく具体的改善提案

### 競合分析
- **市場シェア**: 上位ブランド・ショップ分析
- **価格ポジショニング**: 競合との価格比較
- **差別化要因**: 独自性・強み弱み分析
- **参入機会**: 市場ギャップの発見

このダッシュボードは商品企画・マーケティング・EC運営に携わる方々の意思決定を強力に支援します。リアルタイムデータとAI分析により、競争優位性のある戦略立案が可能になります。